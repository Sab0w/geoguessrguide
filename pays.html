<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>GeoGuessr - Chargement...</title>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<style>
  :root {
    --bg-color: #1a1a1a;
    --card-bg: #2d2d2d;
    --text-color: #ffffff;
    --accent-color: #4285F4;
    --meta-color: #2ecc71;
    --landscape-color: #e67e22;
    --custom-color: #a78bfa;
  }

  * { box-sizing: border-box; }

  body {
    background-color: var(--bg-color);
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    color: var(--text-color);
    margin: 0;
    padding: 0;
    min-height: 100vh;
  }

  .header {
    position: relative;
    height: 300px;
    background-size: cover;
    background-position: center;
    display: flex;
    align-items: flex-end;
    padding: 40px;
  }

  .header::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(to bottom, rgba(0,0,0,0.3), rgba(26,26,26,1));
  }

  .header-content {
    position: relative;
    z-index: 2;
    max-width: 1200px;
    width: 100%;
    margin: 0 auto;
  }

  .back-btn {
    position: absolute;
    top: 20px;
    left: 20px;
    background: rgba(0, 0, 0, 0.7);
    color: white;
    padding: 12px 20px;
    border: 1px solid rgba(255,255,255,0.2);
    border-radius: 8px;
    text-decoration: none;
    font-weight: 600;
    transition: all 0.3s;
    display: flex;
    align-items: center;
    gap: 8px;
    z-index: 10;
  }

  .back-btn:hover {
    background: var(--accent-color);
    border-color: var(--accent-color);
  }

  .country-title {
    font-size: 3rem;
    font-weight: 700;
    margin: 0;
    text-shadow: 0 2px 10px rgba(0,0,0,0.8);
  }

  .continent-badge {
    display: inline-block;
    background: var(--accent-color);
    padding: 6px 16px;
    border-radius: 20px;
    font-size: 0.9rem;
    font-weight: 600;
    margin-top: 10px;
    text-transform: capitalize;
  }

  .content {
    max-width: 1200px;
    margin: 0 auto;
    padding: 40px;
  }

  .section {
    background: var(--card-bg);
    border-radius: 16px;
    padding: 30px;
    margin-bottom: 25px;
    border: 1px solid rgba(255,255,255,0.05);
  }

  .section-title {
    font-size: 1.3rem;
    font-weight: 600;
    margin: 0 0 20px 0;
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .section-title .icon {
    width: 36px;
    height: 36px;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.2rem;
  }

  .section-title .icon.meta {
    background: rgba(46, 204, 113, 0.2);
    color: var(--meta-color);
  }

  .section-title .icon.landscape {
    background: rgba(230, 126, 34, 0.2);
    color: var(--landscape-color);
  }

  .section-title .icon.custom {
    background: rgba(139, 92, 246, 0.2);
    color: var(--custom-color);
  }

  .section-content {
    font-size: 1.1rem;
    line-height: 1.8;
    color: #ccc;
  }

  .hints-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 25px;
  }

  .loading-container, .error-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    min-height: 100vh;
    text-align: center;
    padding: 40px;
  }

  .loading-spinner {
    width: 50px;
    height: 50px;
    border: 4px solid rgba(255,255,255,0.1);
    border-top-color: var(--accent-color);
    border-radius: 50%;
    animation: spin 1s linear infinite;
    margin-bottom: 20px;
  }

  @keyframes spin {
    to { transform: rotate(360deg); }
  }

  .error-icon {
    font-size: 4rem;
    margin-bottom: 20px;
  }

  .error-title {
    font-size: 1.5rem;
    margin: 0 0 10px 0;
  }

  .error-message {
    color: #888;
    margin-bottom: 20px;
  }

  .error-btn {
    background: var(--accent-color);
    color: white;
    padding: 12px 24px;
    border: none;
    border-radius: 8px;
    font-size: 1rem;
    font-weight: 600;
    cursor: pointer;
    text-decoration: none;
    display: inline-block;
    transition: all 0.3s;
  }

  .error-btn:hover {
    background: #3367d6;
  }

  .empty-hint {
    color: #666;
    font-style: italic;
  }

  .external-link {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    background: var(--accent-color);
    color: white;
    padding: 12px 24px;
    border-radius: 8px;
    text-decoration: none;
    font-weight: 600;
    transition: all 0.3s;
    margin-top: 20px;
  }

  .external-link:hover {
    background: #3367d6;
    transform: translateY(-2px);
  }
</style>
</head>
<body>

<div id="app">
  <div class="loading-container" id="loading">
    <div class="loading-spinner"></div>
    <p>Chargement des informations...</p>
  </div>
</div>

<script>
(function() {
  const SUPABASE_URL = 'https://iawoksstpmtppadktnmi.supabase.co';
  const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imlhd29rc3N0cG10cHBhZGt0bm1pIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njg0MzUwOTAsImV4cCI6MjA4NDAxMTA5MH0.vl2Grce9qtU97lDKILYJughIfFpzY1TV-ELdmJkDaKg';
  
  let supabase;

  // R√©cup√©rer l'ID du pays depuis l'URL
  function getCountryId() {
    const params = new URLSearchParams(window.location.search);
    return params.get('id');
  }

  // R√©cup√©rer le continent pour le lien retour
  function getContinent() {
    const params = new URLSearchParams(window.location.search);
    return params.get('continent') || 'europe';
  }

  function initSupabase() {
    if (typeof window.supabase === 'undefined') {
      setTimeout(initSupabase, 100);
      return;
    }
    supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
    loadCountry();
  }

  async function loadCountry() {
    const countryId = getCountryId();
    
    if (!countryId) {
      showError('Aucun pays sp√©cifi√©', 'L\'URL ne contient pas d\'identifiant de pays.');
      return;
    }

    try {
      const { data, error } = await supabase
        .from('countries')
        .select('*')
        .eq('id', countryId)
        .single();

      if (error) throw error;

      if (!data) {
        showError('Pays introuvable', 'Ce pays n\'existe pas dans la base de donn√©es.');
        return;
      }

      renderCountry(data);
    } catch (error) {
      console.error('Erreur:', error);
      showError('Erreur de chargement', 'Impossible de charger les informations du pays.');
    }
  }

  function renderCountry(country) {
    document.title = 'GeoGuessr - ' + country.name;
    
    const continent = country.continent || getContinent();
    const backLink = continent + '.html';
    
    let html = '';
    
    // Header avec drapeau
    html += '<a href="' + backLink + '" class="back-btn">‚Üê Retour</a>';
    html += '<div class="header" style="background-image: url(\'' + (country.flag || 'https://via.placeholder.com/1200x300') + '\')">';
    html += '  <div class="header-content">';
    html += '    <h1 class="country-title">' + country.name + '</h1>';
    html += '    <span class="continent-badge">' + continent + '</span>';
    html += '  </div>';
    html += '</div>';
    
    // Contenu
    html += '<div class="content">';
    html += '  <div class="hints-grid">';
    
    // Section M√©ta
    html += '    <div class="section">';
    html += '      <h2 class="section-title"><span class="icon meta">üîç</span> Indices Techniques (M√©ta)</h2>';
    html += '      <div class="section-content">';
    if (country.meta && country.meta.trim()) {
      html += country.meta;
    } else {
      html += '<span class="empty-hint">Aucun indice technique renseign√©</span>';
    }
    html += '      </div>';
    html += '    </div>';
    
    // Section Paysage
    html += '    <div class="section">';
    html += '      <h2 class="section-title"><span class="icon landscape">üèûÔ∏è</span> Paysage / Route</h2>';
    html += '      <div class="section-content">';
    if (country.land && country.land.trim()) {
      html += country.land;
    } else {
      html += '<span class="empty-hint">Aucun indice paysage renseign√©</span>';
    }
    html += '      </div>';
    html += '    </div>';
    
    html += '  </div>';
    
    // Sections personnalis√©es
    if (country.custom_sections && country.custom_sections.length > 0) {
      html += '<div class="hints-grid">';
      country.custom_sections.forEach(function(section) {
        html += '<div class="section">';
        html += '  <h2 class="section-title"><span class="icon custom">üìå</span> ' + section.name + '</h2>';
        html += '  <div class="section-content">';
        if (section.value && section.value.trim()) {
          html += section.value;
        } else {
          html += '<span class="empty-hint">Non renseign√©</span>';
        }
        html += '  </div>';
        html += '</div>';
      });
      html += '</div>';
    }
    
    // Lien externe si disponible
    if (country.link && country.link !== '#' && country.link.trim()) {
      html += '<a href="' + country.link + '" target="_blank" class="external-link">';
      html += '  üîó Voir plus d\'informations';
      html += '</a>';
    }
    
    html += '</div>';
    
    document.getElementById('app').innerHTML = html;
  }

  function showError(title, message) {
    const continent = getContinent();
    let html = '';
    html += '<div class="error-container">';
    html += '  <div class="error-icon">üòï</div>';
    html += '  <h1 class="error-title">' + title + '</h1>';
    html += '  <p class="error-message">' + message + '</p>';
    html += '  <a href="' + continent + '.html" class="error-btn">‚Üê Retour √† la liste</a>';
    html += '</div>';
    
    document.getElementById('app').innerHTML = html;
    document.title = 'GeoGuessr - Erreur';
  }

  initSupabase();
})();
</script>

</body>
</html>
